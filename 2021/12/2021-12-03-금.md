# CORS란? (1)

### 사건의 발단
오늘 어떤 사이트의 특정 메뉴를 클릭했는데 에러 얼럿창이 뜨면서 화면의 기능이 먹통이 되는 일을 겪었다.<br/>
개발자 도구를 들어가보니 아래와 같은 콘솔 에러를 마구 마구 내뿜고 있었다. 

![기밀 문제로 사이트명은 가렸다.](https://user-images.githubusercontent.com/52793122/144474331-ba07aaf0-0a7e-4d4e-b869-5892c8ff2d8b.png)
(기밀 문제로 사이트명은 가렸다.)


에러를 읽어보니 CORS policy 어쩌구.. Access-Control-Allow-Credentials 저쩌구...<br/>
이 에러를 만난 덕에 CORS라는 단어를 접하게 되었다. CORS는 무엇인지, 어떤 이유로 발생하는 것이며 해결 방법은 무엇인지 알아보자.

---

### SOP(Same Origin Policy)

CORS를 공부하기 전에 먼저 SOP에 대해 짚고 넘어가면 CORS를 이해하는데 도움이 될 것 같다. <br/>
SOP란 **다른 출처의 리소스를 사용하는 것을 제한하는 보안 방식**이라고 한다. 리소스에는 자바스크립트 파일과 같은 것들이 있다. <br/>
여기서 출처란 무엇일까? SOP에서는 URL의 **프로토콜, 호스트, 포트**까지 모두 같아야 동일한 출처라고 말한다. <br/>
예외 사항이 있다면, Internet Explorer는 동일 출처 정책 검사에 포트를 포함하지 않는다고 한다. <br/>

![02](https://user-images.githubusercontent.com/52793122/144474350-d037b851-ec5f-4ad3-8d6a-7d35dccbe3fd.png)


아래 표는 URL `http://localhost` 와 출처 동일 여부를 비교한 예시이다.

| URL | 결과 | 이유 |
| --- | --- | --- |
| https://localhost | 다른 출처 | 프로토콜이 https로 보기의 http와 다르다. |
| http://localhost:80 | 동일한 출처 | http 프로토콜의 기본 포트는 80 포트이므로 프로토콜, 호스트, 포트가 모두 동일하다.  |
| http://127.0.0.1 | 다른 출처 | localhost의 ip는 127.0.0.1이 맞지만, 브라우저 입장에서는 String Value로 구분을 한다고 한다. 
때문에 다른 출처로 판단한다.  |
| http://localhost/api/cors | 동일한 출처 | 프로토콜, 호스트, 포트가 모두 동일하고 Path는 출처 판단에 무의미하다.  |

<br/>
SOP라는 정책이 왜 탄생한 것일까? <br/>
예를 들어 이 정책이 없다는 것은 그냥 아무나 내 도메인 서버에 와서 자원을 가져갈 수 있다는 것이다. <br/>
그럼 악의적인 누군가가 내 도메인 서버에 있는 중요한 정보(비밀번호 같은 것)를 가로채는 스크립트를 만들어 자원을 쉽게 빼 갈 수 있다는 뜻이 된다. <br/>

<br/>

그렇지만 웹 생태계가 다양해지면서 웹 서비스들간에 보다 자유롭게 데이터를 주고 받을 필요가 생겼다. <br/>
때문에, 합의된 출처들 간에 리소스 공유를 합법적으로 허용해주기 위해 어떤 기준을 충족시키면 리소스 공유가 되도록 만들어진 메커니즘이 바로 CORS(Cross-Origin Resource Sharing), 교차 출처 자원 공유 방식이다.