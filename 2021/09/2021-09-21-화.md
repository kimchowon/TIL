# JPAì—ì„œ saveí• ë•Œ select ì¿¼ë¦¬ê°€ ë¨¼ì € ì‹¤í–‰ë˜ëŠ” ì´ìœ 

ìŠ¤í”„ë§ ë°ì´í„° JPAì˜ JpaRepositoryë¡œ saveë¥¼ í•´ë³´ë‹¤ê°€ ì´ìƒí•œ ì ì„ ë°œê²¬í–ˆë‹¤. 

MEMBER í…Œì´ë¸”ì— íšŒì› ê°ì²´ë¥¼ ì €ì¥í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í–ˆë‹¤. 

```jsx
@Test
@DisplayName("íšŒì› ê°ì²´ ë“±ë¡ í…ŒìŠ¤íŠ¸")
void insertMemberTest() {
    // given
    Member member = Member.builder().id("id1").username("ì´ˆì›").age(26).build();

    // when
    Member saveMember = memberRepository.save(member);

    // then
    assertEquals(saveMember.getUsername(), "ì´ˆì›");
}
```
<br/>
ì¿¼ë¦¬ ë¡œê·¸ë¥¼ ì¶œë ¥í•´ë³´ë‹ˆ insert ì¿¼ë¦¬ ì „ì— select ì¿¼ë¦¬ê°€ ì„ ì‹¤í–‰ë˜ê³  ìˆì—ˆë‹¤. 

```jsx
Hibernate: 
    /* load com.study.entity.Member */ select
        member0_.id as id1_0_0_,
        member0_.age as age2_0_0_,
        member0_.name as name3_0_0_ 
    from
        member member0_ 
    where
        member0_.id=?

Hibernate: 
    /* insert com.study.entity.Member
        */ insert 
        into
            member
            (age, name, id) 
        values
            (?, ?, ?)
```

JPAë¥¼ ì´ì œ ë§‰ ê³µë¶€í•˜ëŠ” ë‚˜ëŠ” ë‹¹í™©ìŠ¤ëŸ¬ì› ë‹¤. insert ì¿¼ë¦¬ ì „ì— ë„ëŒ€ì²´ select ì¿¼ë¦¬ê°€ ì™œ ì‹¤í–‰ë ê¹Œ?

<img src="https://user-images.githubusercontent.com/52793122/134377818-ff6fdcfd-ac34-4255-86db-a3a0a807b6e5.png"  width="100" height="100"/>

<br/>
<br/>
<br/>
ê¹€ì˜í•œë‹˜ì˜ ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë°ì— ë‹¤ìŒê³¼ ê°™ì€ ì„¤ëª…ì´ ìˆë‹¤.

> save(S) ë©”ì†Œë“œëŠ” ì—”í‹°í‹°ì— ì‹ë³„ì ê°’ì´ ì—†ìœ¼ë©´(nullì´ë©´) ìƒˆë¡œìš´ ì—”í‹°í‹°ë¡œ íŒë‹¨í•´ì„œ EntityManager.persistë¥¼ í˜¸ì¶œí•˜ê³  ì‹ë³„ì ê°’ì´ ìˆìœ¼ë©´ ì´ë¯¸ ìˆëŠ” ì—”í‹°í‹°ë¡œ íŒë‹¨í•´ì„œ EntityManager.merge()ë¥¼ í˜¸ì¶œí•œë‹¤.

ìœ„ ë‚´ìš©ì— ê¸°ë°˜í•˜ì—¬ ì¡°ê¸ˆ ë” ìì„¸í•˜ê²Œ ì‚´í´ë³´ì•˜ë‹¤.

ì‹ë³„ì ê°’ì¸ idë¥¼ ì—”í‹°í‹°ì— ì§ì ‘ ì§€ì •í•˜ì—¬ insertí•˜ë©´ ìœ„ì—ì„œ ì„¤ëª…í–ˆë“¯ì´ select ì¿¼ë¦¬ê°€ ì„ í˜¸ì¶œë˜ê³  ê·¸ ë‹¤ìŒ insert ì¿¼ë¦¬ê°€ ì‹¤í–‰ëœë‹¤. 
![02](https://user-images.githubusercontent.com/52793122/134377833-d359b568-c511-4372-897b-d35f54289c7e.png)

ê·¸ëŸ¼ id1ì„ ì‹ë³„ìë¡œ ê°€ì§„ ë ˆì½”ë“œë¥¼ ìˆ˜ì •í•˜ë©´ ì–´ë–»ê²Œ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë ê¹Œ? 
usernameì„ "ì´ˆì›" â†’ "íš¨ì›"ìœ¼ë¡œ ë°”ê¾¸ê³  ì‹¤í–‰í•´ë³´ì•˜ë‹¤. 
![03](https://user-images.githubusercontent.com/52793122/134377836-cd8e0955-b817-4d82-80e0-c46ccc69f09e.png)
```jsx
Hibernate: 
    /* load com.study.entity.Member */ select
        member0_.id as id1_0_0_,
        member0_.age as age2_0_0_,
        member0_.name as name3_0_0_ 
    from
        member member0_ 
    where
        member0_.id=?

Hibernate: 
    /* update
        com.study.entity.Member */ update
            member 
        set
            age=?,
            name=? 
        where
            id=?
```

ë§ˆì°¬ê°€ì§€ë¡œ select ì¿¼ë¦¬ê°€ ì„ í˜¸ì¶œë˜ì—ˆê³ , ê¸°ì¡´ì— id1ì„ ì‹ë³„ìë¡œ ê°€ì§€ëŠ” ë ˆì½”ë“œë¥¼ ìˆ˜ì •í•œ ê²ƒì´ê¸° ë•Œë¬¸ì— ì´ë²ˆì—ëŠ” update ì¿¼ë¦¬ê°€ í˜¸ì¶œë˜ì—ˆë‹¤. 
<br/>
ì´ë²ˆì—ëŠ” ì•„ë¬´ ë³€ê²½ë„ ì—†ì´ í•œë²ˆ ë” save ì‹œì¼œ ë³´ì•˜ë‹¤. 
![04](https://user-images.githubusercontent.com/52793122/134377839-b4fe6dcc-0145-4918-8708-ce472bcac1ef.png)

```jsx
Hibernate: 
    /* load com.study.entity.Member */ select
        member0_.id as id1_0_0_,
        member0_.age as age2_0_0_,
        member0_.name as name3_0_0_ 
    from
        member member0_ 
    where
        member0_.id=?
```

ì´ë²ˆì—ëŠ” selectë§Œ í˜¸ì¶œë˜ì—ˆë‹¤. ë³€ê²½ëœ í•„ë“œê°€ ì—†ê¸° ë•Œë¬¸ì— ë¶ˆí•„ìš”í•œ updateì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ë‹¤.
 
<br/>

ë²ˆì™¸ë¡œ í•˜ë‚˜ ë” í…ŒìŠ¤íŠ¸í•´ë³´ì•˜ë‹¤. IDENTITY ì „ëµì„ ì‚¬ìš©í•˜ì—¬ ê¸°ë³¸í‚¤ ìƒì„±ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ìœ„ì„í•˜ì˜€ë‹¤. ê·¸ë¦¬ê³  ì—”í‹°í‹°ì— ì‹ë³„ì ê°’ì„ ì§€ì •í•˜ì§€ ì•Šì€ì±„ë¡œ saveí•´ë³´ì•˜ë‹¤.

í…Œì´ë¸” ë³€ê²½
```jsx
CREATE TABLE MEMBER (
	ID VARCHAR(255) NOT NULL AUTO_INCREMENT PRIMARY KEY, --ì•„ì´ë””(ê¸°ë³¸í‚¤)
	NAME VARCHAR(255), --ì´ë¦„
	AGE INTEGER NOT NULL, --ë‚˜ì´
	PRIMARY KEY (ID)
);
```
<br/>
ì—”í‹°í‹° ìˆ˜ì •
```jsx
@Entity
@Builder
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Table(name = "MEMBER")
public class Member {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY) // ì¶”ê°€
    private String id;

    @Column(name = "NAME")
    private String username;

    private int age;
}
```
<br/>

í…ŒìŠ¤íŠ¸ ì½”ë“œ
```jsx
@Test
@DisplayName("íšŒì› ê°ì²´ ë“±ë¡ í…ŒìŠ¤íŠ¸")
void insertMemberTest() {
    // given
    Member member = Member.builder().username("í˜„í˜¸").age(25).build();

    // when
    Member saveMember = memberRepository.save(member);

    // then
    assertEquals(saveMember.getUsername(), "í˜„í˜¸");
}
```
<br/>
ì‹¤í–‰ ì¿¼ë¦¬
```jsx
Hibernate: 
    /* insert com.study.entity.Member
        */ insert 
        into
            member
            (id, age, name) 
        values
            (null, ?, ?)
```

ì‹ë³„ì ê°’ì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë‹ˆ í•´ë‹¹ saveê°€ insertì¸ì§€ updateì¸ì§€ íŒë‹¨í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— selectì¿¼ë¦¬ê°€ ì„ í˜¸ì¶œë˜ì§€ ì•Šê³  ë°”ë¡œ insert ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ì—ˆë‹¤. 
<br/>
## ğŸ¶ê²°ë¡ ğŸ±
JpaRepositoryì˜ saveë©”ì†Œë“œë¥¼ í˜¸ì¶œí•  ë•Œ ì—”í‹°í‹°ì— ì‹ë³„ì ê°’ì´ ì§€ì •ë˜ì–´ìˆìœ¼ë©´ ë‚´ë¶€ì ìœ¼ë¡œ selectì¿¼ë¦¬ê°€ ì„  ì‹¤í–‰ëœë‹¤. 

select ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•œ ê²°ê³¼ì— ë”°ë¼ì„œ ë‹¤ìŒì— ì‹¤í–‰í•  ì¿¼ë¦¬ê°€ ê²°ì •ëœë‹¤. 

- í…Œì´ë¸”ì— ì§€ì •í•œ ì‹ë³„ì ê°’ì´ ì—†ëŠ” ê²½ìš° - insert ì¿¼ë¦¬ ì‹¤í–‰
- í…Œì´ë¸”ì— ì§€ì •í•œ ì‹ë³„ì ê°’ì´ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²½ìš° - update ì¿¼ë¦¬ ì‹¤í–‰
- í…Œì´ë¸”ì— ì§€ì •í•œ ì‹ë³„ì ê°’ì´ ì´ë¯¸ ì¡´ì¬í•˜ì§€ë§Œ ë°ì´í„°ì˜ ë³€ê²½ì´ ì—†ëŠ” ê²½ìš° - ì¿¼ë¦¬ ì‹¤í–‰ ì•ˆí•¨

à¸„Ê•â€¢ï»Œâ€¢Ê”à¸„    âœ¿Ë˜â—¡Ë˜âœ¿