# JPA í•™ìŠµ í™˜ê²½ êµ¬ì„±í•´ë³´ê¸°2(ìŠ¤í”„ë§ ë°ì´í„° JPA, gradle ì„¤ì •)

ì–´ì œëŠ” JPA í•™ìŠµ í™˜ê²½ì„ ìœ„í•œ H2 ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ì„ í•´ë´¤ë‹¤. ì˜¤ëŠ˜ì€ ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì—ì„œ JPAë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ìŠ¤í”„ë§ ë°ì´í„° JPA ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•˜ê³  MEMBER í…Œì´ë¸”ì„ ë§Œë“¤ì–´ ê°ì²´ë¥¼ ë“±ë¡/ìˆ˜ì •/ì¡°íšŒ/ì‚­ì œ í•˜ëŠ” ê°„ë‹¨í•œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ë ¤ê³  í•œë‹¤. 

## 1. ìŠ¤í”„ë§ ë°ì´í„° JPA ì†Œê°œ

ìŠ¤í”„ë§ ë°ì´í„° JPAëŠ” ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì—ì„œ JPAë¥¼ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ëŠ” í”„ë¡œì íŠ¸ì´ë‹¤. 

í”íˆ ë°ì´í„° ì ‘ê·¼ ê³„ì¸µì—ì„œëŠ” ê°ì²´ì— ëŒ€í•œ CRUD ì½”ë“œë“¤ì„ ë§¤ë²ˆ êµ¬í˜„í•´ì•¼ í•œë‹¤. ìŠ¤í”„ë§ ë°ì´í„° JPAì—ì„œëŠ” ê°ì²´ì— ëŒ€í•œ CRUDë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ê³µí†µ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•œë‹¤. ë•Œë¬¸ì— ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë§Œ ë°›ì•„ë„ CRUD ê¸°ëŠ¥ì„ ëª¨ë‘ í•´ê²°í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤. ë˜í•œ ë©”ì†Œë“œì˜ ì´ë¦„ì„ ë¶„ì„í•´ì„œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•´ì£¼ëŠ” ì‹ ê¸°í•œ ê¸°ëŠ¥ë„ ìˆë‹¤. 

ì±…ì—ì„œëŠ” ì²˜ìŒë¶€í„° ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  hibernate êµ¬í˜„ì²´ë¡œ JPAë¥¼ ê°€ë¥´ì³ ì¤€ë‹¤. 
ë‚˜ëŠ” JPAë¥¼ ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìµœì ì˜ ë¬¸ë²•ìœ¼ë¡œ ê³µë¶€ í•  ê±°ê¸° ë•Œë¬¸ì— ë°”ë¡œ ìŠ¤í”„ë§ ë°ì´í„° JPA ë¬¸ë²•ìœ¼ë¡œ ì‹¤ìŠµì„ í•˜ë ¤ê³  í•œë‹¤. í•˜ì§€ë§Œ ì¡°ê¸ˆ í—·ê°ˆë¦°ë‹¤. JPA, hibernate, ìŠ¤í”„ë§ ë°ì´í„° JPAëŠ” ê°ê° ì–´ë–»ê²Œ ë‹¤ë¥¸ ê²ƒì¼ê¹Œ? ì´ ê²ƒì€ ë‚˜ì¤‘ì— ë”°ë¡œ ê³µë¶€ë¥¼ í•´ë³´ë ¤ê³  í•œë‹¤. 

ìš°ì„  ì„¤ëª…ì´ ì˜ ë‚˜ì™€ìˆëŠ” ë¸”ë¡œê·¸ ê¸€ì„ ì°¾ì•„ë‘ì—ˆë‹¤. 

[JPA, Hibernate, ê·¸ë¦¬ê³  Spring Data JPAì˜ ì°¨ì´ì ](https://suhwan.dev/2019/02/24/jpa-vs-hibernate-vs-spring-data-jpa/)

## 2. í™˜ê²½ êµ¬ì„±

### gradle íŒŒì¼

```jsx
plugins {
    id 'org.springframework.boot' version '2.2.5.RELEASE' // ìŠ¤í”„ë§ë¶€íŠ¸ í”ŒëŸ¬ê·¸ì¸
    id 'io.spring.dependency-management' version '1.0.9.RELEASE' // ìŠ¤í”„ë§ ì˜ì¡´ì„± ê´€ë¦¬ í”ŒëŸ¬ê·¸ì¸
    id 'java'
}

group 'org.example'
version '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

dependencies {
    testImplementation'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.3.1'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.3.1'

    implementation 'org.springframework.boot:spring-boot-starter-web'

    // lombok
    compileOnly 'org.projectlombok:lombok:1.18.12'
    annotationProcessor 'org.projectlombok:lombok:1.18.12'

    // jdbc
    implementation 'org.springframework.boot:spring-boot-starter-jdbc'

    // H2
    runtimeOnly 'com.h2database:h2'

    // jpa
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa:2.5.4'
}

test {
    useJUnitPlatform()
}
```

### application.yml

```jsx
spring:
  #H2
  h2:
    console:
      enabled: true
      path: /h2-console
  datasource:
    url: jdbc:h2:~/test
    username: sa
    password:

  #JPA
  jpa:
    hibernate:
      ddl-auto: none
    properties:
      hibernate:
        show_sql: true
        use_sql_comments: true
        format_sql: true
```

## 3. í…Œì´ë¸” ìƒì„±

gradleê³¼ application.ymlì— í™˜ê²½ ì„¸íŒ…ì„ í•˜ì˜€ìœ¼ë‹ˆ ì´ì œ ê°„ë‹¨í•œ ì˜ˆì œë¥¼ ì‹¤ìŠµí•  í…Œì´ë¸”ì„ ë§Œë“¤ì–´ ë³´ì.

ì–´ì œ ì‹¤ìŠµí–ˆë˜ ê²ƒì²˜ëŸ¼ H2 ë°ì´í„°ë² ì´ìŠ¤ ì›¹ ì½˜ì†”ì—ì„œ MEMBER í…Œì´ë¸”ì„ ìƒì„±í•œë‹¤. 

![01](https://user-images.githubusercontent.com/52793122/133966017-b7c46a1f-5f24-498d-b43d-23caf1096ade.png)


## 4. Entity ìƒì„±

JPAë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ íšŒì› í´ë˜ìŠ¤ì™€ íšŒì› í…Œì´ë¸”ì„ ë§¤í•‘í•´ì•¼ í•œë‹¤. MEMBER í…Œì´ë¸”ê³¼ ë§¤í•‘í•  Member Entityë¥¼ ìƒì„±í•œë‹¤. 

```jsx
package com.study.entity;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.Table;

@Entity
@Builder
@Getter
@NoArgsConstructor
@AllArgsConstructor
@Table(name = "MEMBER")
public class Member {

    @Id
    private String id;

    @Column(name = "NAME")
    private String username;

    private int age;
}
```

- @Entity:
- ì´ í´ë˜ìŠ¤ê°€ í…Œì´ë¸”ê³¼ ë§¤í•‘í•œë‹¤ê³  JPAì—ê²Œ ì•Œë ¤ì¤€ë‹¤.
- @Table:
- Entity í´ë˜ìŠ¤ì— ë§¤í•‘í•  í…Œì´ë¸”ì„ ì•Œë ¤ì¤€ë‹¤. 
- ì´ ì–´ë…¸í…Œì´ì…˜ì„ ìƒëµí•˜ë©´ í´ë˜ìŠ¤ ì´ë¦„ìœ¼ë¡œ í…Œì´ë¸”ê³¼ ë§¤í•‘ëœë‹¤.
- @Id
- Entity í´ë˜ìŠ¤ì˜ í•„ë“œë¥¼ í…Œì´ë¸”ì˜ ê¸°ë³¸í‚¤(Primary key)ì— ë§¤í•‘í•œë‹¤. 
- @Idê°€ ì‚¬ìš©ëœ í•„ë“œë¥¼ ì‹ë³„ì í•„ë“œë¼ê³  í•œë‹¤.
- @Column
- í•„ë“œë¥¼ ì»¬ëŸ¼ì— ë§¤í•‘í•œë‹¤. 
- ì—¬ê¸°ì„œëŠ” MEMBER í…Œì´ë¸”ì˜ NAME ì»¬ëŸ¼ê³¼ í´ë˜ìŠ¤ì˜ username í•„ë“œë¥¼ ë§¤í•‘í–ˆë‹¤.

ë‚˜ë¨¸ì§€ ì–´ë…¸í…Œì´ì…˜ì€ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ì— í•„ìš”í•˜ì—¬ ì¶”ê°€í•œ ì–´ë…¸í…Œì´ì…˜ë“¤ì´ë‹¤. 

## 5. Repository ìƒì„±

ìŠ¤í”„ë§ ë°ì´í„° JPAëŠ” ê°„ë‹¨í•œ CRUD ê¸°ëŠ¥ì„ ê³µí†µìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” JpaRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•œë‹¤. 

```jsx
/**
 * JPA specific extension of {@link org.springframework.data.repository.Repository}.
 *
 * @author Oliver Gierke
 * @author Christoph Strobl
 * @author Mark Paluch
 */
@NoRepositoryBean
public interface JpaRepository<T, ID> extends PagingAndSortingRepository<T, ID>, QueryByExampleExecutor<T> {

		...
}
```

ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ì‚¬ìš©í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì„±í•´ì„œ JpaRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ì•„ ì‚¬ìš©í•˜ë©´ ëœë‹¤. 

ê·¸ë¦¬ê³  ì œë„¤ë¦­ì— Entity í´ë˜ìŠ¤ì™€ Entity í´ë˜ìŠ¤ê°€ ì‚¬ìš©í•˜ëŠ” ì‹ë³„ì íƒ€ì…ì„ ì§€ì •í•˜ë©´ ëœë‹¤. 

```jsx
package com.study.repository;

import com.study.entity.Member;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface MemberRepository extends JpaRepository<Member, String>{
}
```

ì´ì œ MemberRepositoryì—ì„œ JpaRepository ì¸í„°í˜ì´ìŠ¤ê°€ ì œê³µí•˜ëŠ” ë©”ì†Œë“œë“¤ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 

ì£¼ìš” ë©”ì†Œë“œë“¤ì„ ì‚¬ìš©í•˜ì—¬ MEMBER í…Œì´ë¸”ì— CRUD ì‘ì—…ì„ í•´ë³´ì. 

## 6. MEMBER í…Œì´ë¸”ì— ê°ì²´ ë“±ë¡/ìˆ˜ì •/ì¡°íšŒ/ì‚­ì œ í•´ë³´ê¸°

### 1)ë“±ë¡

```jsx
package com.study.repository;

import com.study.entity.Member;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.annotation.Rollback;

import static org.junit.jupiter.api.Assertions.assertEquals;

@SpringBootTest
@Rollback(value = false)
class MemberRepositoryTest {

    @Autowired
    private MemberRepository memberRepository;

    @Test
		@DisplayName("íšŒì› ê°ì²´ ë“±ë¡")
    void insertMemberTest() {
        // given
        Member member = Member.builder().id("id1").username("ì´ˆì›").age(26).build();

        // when
        Member saveMember = memberRepository.save(member);

        // then
        assertEquals(saveMember.getUsername(), "ì´ˆì›");
    }
}
```

### ğŸŒˆê²°ê³¼ğŸ¥°

![02](https://user-images.githubusercontent.com/52793122/133966025-553709b6-bdd5-4fcd-90a0-fe5b2cf9dfc2.png)


### 2) ìˆ˜ì •

```jsx
@Test
    @DisplayName("íšŒì› ê°ì²´ ìˆ˜ì • í…ŒìŠ¤íŠ¸")
    void updateMemberTest() {
        // given - nothing

        // when
        Optional<Member> optionalMember = memberRepository.findById("id1");
        Member member = optionalMember.get();
        member.setAge(29);
        Member saveMember = memberRepository.save(member);

        assertEquals(saveMember.getAge(), 29);
    }
```

### ğŸŒˆê²°ê³¼ğŸ¥°

![03](https://user-images.githubusercontent.com/52793122/133966026-f2bdad1f-de67-441f-8cd1-e92009681b03.png)


### 3) ì¡°íšŒ

```jsx
@Test
    @DisplayName("íšŒì› ê°ì²´ ì¡°íšŒ í…ŒìŠ¤íŠ¸")
    void selectMemberTest() {
        // given - nothing

        // when
        Optional<Member> member = memberRepository.findById("id1");

        // then
        assertEquals(member.get().getUsername(), "ì´ˆì›");
    }
```

### 4) ì‚­ì œ

```jsx
@Test
    @DisplayName("íšŒì› ê°ì²´ ì‚­ì œ í…ŒìŠ¤íŠ¸")
    void deleteMemberTest() {
        // given

        // when
        Optional<Member> optionalMember = memberRepository.findById("id1");
        Member member = optionalMember.get();

        memberRepository.delete(member);

        optionalMember = memberRepository.findById("id1");
        assertFalse(optionalMember.isPresent());
    }
```